<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/main.scss">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css" />
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const bannerImg = $('.main_visual img')
            const bannerImgCount = bannerImg.length;
            const bannerImageWidth = 1420;
            const slides = document.querySelectorAll(".slide");
            const slideContainer = document.querySelector(".new_arrival_contents");
            const progressBar = document.querySelector(".progress");
            const prevSlideButton = document.querySelector('#prevSlide')
            const nextSlideButton = document.querySelector('#nextSlide')
            const imageElements = document.querySelectorAll('.slide img');
            let bannerAuto;
            let bannerCurrentIndex = 0;
            let slideIndex = 0;
            let startX;
            let distance;
            let autoSlide;

            imageElements.forEach((img) => {
                img.addEventListener('dragstart', (e) => {
                    e.preventDefault();
                });
            });

            $(function () {
                $(window).scroll(function () {
                    if ($(window).scrollTop() >= 80) {
                        $('.header').addClass('fixed')
                    } else {
                        $('.header').removeClass('fixed')
                    }
                })
            })

            function bannerPlay() {
                clearInterval(bannerAuto); // 추가: 이전 setInterval을 명확하게 제거
                bannerAuto = setInterval(function () {
                    updateSlide((bannerCurrentIndex + 1) % bannerImgCount);
                }, 2000);
            }

            function updateSlide(index) {
                bannerImg.each(function (i) {
                    $(this).css('left', ((i - index) * bannerImageWidth) + 'px');
                });
                $(".dot").removeClass("active");
                $("#dot" + index).addClass("active");
                bannerCurrentIndex = index;
                
            }

            $('#mainPrevButton').click(function () {
                clearInterval(bannerAuto);
                updateSlide((bannerCurrentIndex - 1 + bannerImgCount) % bannerImgCount);
                bannerPlay();
            });

            $('#mainNextButton').click(function () {
                clearInterval(bannerAuto);
                updateSlide((bannerCurrentIndex + 1) % bannerImgCount);
                bannerPlay();
            });

            $('.main_visual').hover(function () {
                clearInterval(bannerAuto);
            }, function () {
                bannerPlay();
            });
            $(".dot").each(function (index) {
                $(this).click(function () {
                    clearInterval(bannerAuto);
                    updateSlide(index);
                    bannerPlay();
                });
            });

            bannerPlay();

            function updateProgressBar() {
                const progressPercent = (slideIndex / (slides.length)) * 100;
                document.querySelector('.progress').style.left = `${progressPercent}%`;
            }

            function handleDragStart(e) {
                startX = e.clientX;
            }

            function handleDragEnd(e) {
                distance = startX - e.clientX;
                if (distance > 0) {
                    showNextSlide();
                } else if (distance < 0) {
                    showPrevSlide();
                }
            }

            function showPrevSlide() {
                slideIndex--;
                if (slideIndex < 0) {
                    slideIndex = slides.length - 1;
                }
                slideContainer.style.transform = `translateX(${-slideIndex * slides[0].clientWidth}px)`;
                updateProgressBar();
            }

            function showNextSlide() {
                slideIndex++;
                if (slideIndex >= slides.length) {
                    slideIndex = 0;
                }
                slideContainer.style.transform = `translateX(${-slideIndex * slides[0].clientWidth}px)`;
                updateProgressBar();
            }

            function startAutoSlide() {
                autoSlide = setInterval(showNextSlide, 2000);
            }

            function stopAutoSlide() {
                clearInterval(autoSlide);
            }

            slideContainer.addEventListener("mousedown", handleDragStart);
            slideContainer.addEventListener("mouseup", handleDragEnd);
            slideContainer.addEventListener("mouseenter", stopAutoSlide);
            slideContainer.addEventListener("mouseleave", startAutoSlide);
            document.getElementById("prevSlide").addEventListener("click", showPrevSlide);
            document.getElementById("nextSlide").addEventListener("click", showNextSlide);
            prevSlideButton.addEventListener("mouseenter", stopAutoSlide);
            nextSlideButton.addEventListener("mouseenter", stopAutoSlide);
            prevSlideButton.addEventListener("mouseleave",
                startAutoSlide);
            nextSlideButton.addEventListener("mouseleave",
                startAutoSlide);
            startAutoSlide();
            updateProgressBar();
        })
    </script>
</head>

<body>
    <div class="wrap">
        <header class="header">
            <div class="logo">
                <img src="./img/1962.png" alt="">
            </div>
            <div class="lnb">
                <div>shop</div>
                <div>our story</div>
                <div>special project</div>
                <div>support</div>
                <div>contact</div>
            </div>
            <div class="gnb">
                <div class="search-container">
                    <input type="search" class="search">
                    <button type="submit" class="search-button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="login">
                    <i class="fas fa-sign-in-alt"></i>
                </div>
                <div class="mypage">
                    <i class="fas fa-user"></i>
                </div>
                <div class="cart">
                    <i class="fas fa-shopping-cart"></i>
                </div>
            </div>
        </header>
        <div class="main_visual">
            <img src="./img/109.jpg" alt="" style="left: 0">
            <img src="./img/114.jpg" alt="" style="left: 1420px">
            <img src="./img/116.jpg" alt="" style="left: 2840px">
            <img src="./img/120.jpg" alt="" style="left: 4260px">
            <img src="./img/112.jpg" alt="" style="left: 5480px">
            <i class="fas fa-chevron-left" id="mainPrevButton"></i>
            <i class="fas fa-chevron-right" id="mainNextButton"></i>
            <div id="mainDots">
                <div class="dot active" id="dot0"></div>
                <div class="dot" id="dot1"></div>
                <div class="dot" id="dot2"></div>
                <div class="dot" id="dot3"></div>
                <div class="dot" id="dot4"></div>
            </div>
        </div>
        <div class="new_arrival">
            <h2>new arrivals</h2>
            <i class="fas fa-chevron-left" id="prevSlide"></i>
            <div class="new_arrival_slide">
                <ul class="new_arrival_contents">
                    <li class="slide slide1">
                        <div><img src="./img/MAGRITTE-1.png" alt=""></div>
                        <div><img src="./img/ACORN-1.png" alt=""></div>
                        <div><img src="./img/e-1.png" alt=""></div>
                    </li>
                    <li class="slide slide2">
                        <div><img src="./img/CANDLE-1.png" alt=""></div>
                        <div><img src="./img/SNOWMAN-1.png" alt=""></div>
                        <div><img src="./img/sub-1.png" alt=""></div>
                    </li>
                    <li class="slide slide3">
                        <div><img src="./img/sub01.png" alt=""></div>
                        <div><img src="./img/sub02.png" alt=""></div>
                        <div><img src="./img/sub03.png" alt=""></div>
                    </li>
                    <li class="slide slide4">
                        <div><img src="./img/sub-2.png" alt=""></div>
                        <div><img src="./img/sub-3.png" alt=""></div>
                        <div><img src="./img/sub-4.png" alt=""></div>
                    </li>
                </ul>
            </div>
            <i class="fas fa-chevron-right" id="nextSlide"></i>
            <div class="progress_bar">
                <div class="progress"></div>
            </div>
        </div>
        <div class="best">
            <h2>Best</h2>
            <div class="best_container">
                <ul>
                    <li><img src="./img/123.jpg" alt=""></li>
                    <li><img src="./img/1234.jpg" alt=""></li>
                    <li><img src="./img/2134.jpg" alt=""></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
                <i class="fas fa-chevron-left"></i>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>
        <div class="recommend">

        </div>
        <div class="brand_story">

        </div>
        <footer class="footer">
        </footer>
    </div>
</body>

</html>